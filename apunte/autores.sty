% **************************************************************************
%  Package 'autores', para agregar autores a un apunte del proyecto 
%  ``apuntes-fiuba''
%
%  Basado en el Package 'caratula', version 0.5 (para componer caratulas de
%  TPs del DC), hecho por Brian J.Cardiff y Nico Rosner
%
% **************************************************************************

% ----- Informacion sobre el package para el sistema -----------------------

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{autores}[2015/01/08 Para agregar autores a un apunte FIUBA]
\RequirePackage{ifthen}
\usepackage[pdftex]{graphicx}

% ----- Imprimir un mensajito al procesar un .tex que use este package -----

\typeout{Cargando package 'autores' (2015/01/08)}

% ----- Algunas variables --------------------------------------------------
\newcommand{\LabelAutores}{}
\newboolean{showPadron}

% ----- Token list para los autores ------------------------------------

\newtoks\autlist\autlist={}

\newtoks\autlistSinPadron\autlistSinPadron={}

\newcounter{autoresCount}
\setcounter{autoresCount}{0}
\newtoks\autTabNombre\autTabNombre={}
\newtoks\autTabPadron\autTabPadron={}
\newtoks\autTabEmail\autTabEmail={}

% ----- Comando para que el usuario agregue autores --------------------

\def\autor#1#2#3{%
    \autlist=\expandafter{\the\autlist\rule{0pt}{1.2em}#1&#2&\tt #3\\[0.2em]}%
    \autlistSinPadron=\expandafter{\the\autlistSinPadron\rule{0pt}{1.2em}#1 & \tt #3\\[0.2em]}%
    %
    \ifthenelse{\value{autoresCount} > 0}{%
        \autTabNombre=\expandafter{\the\autTabNombre & #1}%
        \autTabPadron=\expandafter{\the\autTabPadron & #2}%
        \autTabEmail=\expandafter{\the\autTabEmail & \tt #3}%
    }{
        \autTabNombre=\expandafter{\the\autTabNombre #1}%
        \autTabPadron=\expandafter{\the\autTabPadron #2}%
        \autTabEmail=\expandafter{\the\autTabEmail \tt #3}%
    }%
    \addtocounter{autoresCount}{1}%
}

% ----- Macro para generar la tabla de autores -------------------------

\newcommand{\tablaAutores}{\ }

\newcommand{\tablaAutoresVertical}{%
\ifthenelse{\boolean{showPadron}}{%
    \begin{tabular}[t]{ l @{\hspace{4ex}} c @{\hspace{4ex}} l}
        \multicolumn{1}{c}{\rule{0pt}{1.2em} \LabelAutores} & Padron &  \multicolumn{1}{c}{Correo electr\'onico} \\[0.2em]
        \hline \hline
        \the\autlist
    \end{tabular}
}{
    \begin{tabular}[t]{ l @{\hspace{4ex}} @{\hspace{4ex}} l}
        \multicolumn{1}{c}{\rule{0pt}{1.2em} \LabelAutores} &  \multicolumn{1}{c}{Correo electr\'onico} \\[0.2em]
        \hline \hline
        \the\autlistSinPadron
    \end{tabular}
    }%
}

\newcommand{\tablaAutoresHorizontal}{%
    \begin{tabular}[t]{ *{\value{autoresCount}}{c} }
    \the\autTabNombre \\%
\ifthenelse{\boolean{showPadron}}{
    \the\autTabPadron \\%
}{}
    \the\autTabEmail %
    \end{tabular}%
}

% ----- Codigo para manejo de errores --------------------------------------

\def\se{\let\ifsetuperror\iftrue}
\def\ifsetuperror{%
    \let\ifsetuperror\iffalse
    \edef\mlist{\the\autlist}\ifx\mlist\empty\se%
    \errhelp={Tenes que proveer al menos un \autor{nombre}{padron}{email}.}\fi
    \expandafter\ifsetuperror}

\def\aftermaketitle{%
  \setcounter{page}{1}
}

% ----- \mostrarautores - comando para mostrar la tabla de autores en el documento ---------

\def\mostrarautores{%
    \ifsetuperror\errmessage{Faltan datos de la tabla de autores! Ingresar 'h' para mas informacion.}\fi
    \begin{center}
	\bigskip
	\textbf{\huge Autores del apunte}\\
	\smallskip
      \tablaAutores
    \end{center}
    \vspace*{\stretch{3}}
  
  \newpage\aftermaketitle}

\@makeother\*% some package redefined it as a letter (as color.sty)
%
% Etiqueta Autores o Editores
%
\DeclareOption{autor}{\renewcommand{\LabelAutores}{Autor}}
\DeclareOption{editor}{\renewcommand{\LabelAutores}{Editor}}
%
% Formato tabla de autores
%
\DeclareOption{autVert}{\renewcommand{\tablaAutores}{\tablaAutoresVertical}}
\DeclareOption{autHoriz}{\renewcommand{\tablaAutores}{\tablaAutoresHorizontal}}
\DeclareOption{conPadron}{\setboolean{showPadron}{true}}
\DeclareOption{sinPadron}{\setboolean{showPadron}{false}}
%
% Opciones predeterminadas
%
\ExecuteOptions{autVert}%
\ExecuteOptions{graf}%
\ExecuteOptions{autor}%
\ExecuteOptions{conPadron}%
%
\ProcessOptions\relax
